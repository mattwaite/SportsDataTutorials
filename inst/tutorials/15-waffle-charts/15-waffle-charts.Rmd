---
title: "Sports Data Lesson 15: Waffle charts"
output: 
  learnr::tutorial:
    progressive: true
    allow_skip: true
    theme: united
    ace_theme: github
runtime: shiny_prerendered
description: >
  Learn how to make another chart that shows magnitude and composition.
---

```{r setup, include=FALSE}
library(learnr)
library(gradethis)
library(tidyverse)
knitr::opts_chunk$set(echo = FALSE)
tutorial_options(exercise.completion=FALSE)
```

## The Goal

The goal of this lesson is to introduce you to waffle charts, an effective alternative to pie charts for visualizing proportions and compositions. By the end of this tutorial, you'll understand why waffle charts are often preferred over pie charts for certain types of data visualization. You'll learn how to create basic waffle charts, including how to prepare your data using some new tricks and customize chart appearance. We'll apply these concepts to real sports data. This lesson will enhance your data visualization toolkit, allowing you to present proportional data in a clear, engaging, and easily interpretable format that's particularly useful for sports analytics.

## The Basics

Pie charts are the devil. Pure evil. They should be an instant F in any data visualization class. The problem? How carefully can you evaluate angles and area? Unless they are blindingly obvious and only a few categories, not well. If you've got 25 categories, how can you tell the difference between 7 and 9 percent? You can't.

So let's introduce a better way: The Waffle Chart. Some call it a square pie chart. I personally hate that. Waffles it is. 

**A waffle chart is designed to show you parts of the whole -- proportionality**. How many yards on offense come from rushing or passing. How many singles, doubles, triples and home runs make up a teams hits. How many shots a basketball team takes are two pointers versus three pointers. 

If you Google making waffle charts in R, you're going to find a library called `waffle` that does this pretty easily. Worse, if you ask AI to do it for you -- don't, that's an academic integrity violation -- it will use the waffle library do this. Problem? The library is abandoned. It won't install (easily) and worse, will slowly break in not-easily-understood ways. 

This library breaking is a new thing, so you're among the first to do it with just ggplot. And it's not that tough to pull off. We just need the `tidyverse`. 

```{r load-waffle, exercise=TRUE}
library(tidyverse)
```
```{r load-waffle-solution}
library(tidyverse)
```
```{r load-waffle-check}
grade_this_code()
```

## Making waffles with grids

Let's look at Nebraska's 2025 softball team -- among the five most successful softball teams in Husker history. How good? They set school records for batting average, home runs, extra base hits, RBIs, slugging percentage and total bases on the way to the second most post-season wins in school history. 

What does that look like in a waffle chart? First, we have to make the data. We're going to look at the breakdown of hits -- how many singles, doubles, triples, and home runs they had. First here, we're going do that manually. The way you do it is you create a `category` and make a list of the categories. Then you create a `count` and make a list of the numbers that correspond to each category. When you see it here, it'll make more sense. 

```{r waffle-load-data, message=FALSE, warning=FALSE}
rows <- 10

softball <- data.frame(
  category = c("1B", "2B", "3B", "HR"),
  count = c(325, 101, 10, 107)
)

waffle_softball <- softball |>
  uncount(count) |>
  mutate(
    x = (row_number() - 1) %/% rows + 1,
    y = (row_number() - 1) %% rows + 1
  )

softball_teams <- read_csv("https://mattwaite.github.io/sportsdatafiles/ncaa_womens_softball_teams_2025.csv")

team_rows <- 5

team_waffle <- softball_teams |> 
  filter(conference == "Big Ten") |> 
  select(team, w, l, t) |> 
  pivot_longer(cols=-team, names_to = "category", values_to ="count") |> 
  uncount(count) |>
  group_by(team) |> 
  mutate(
    x = (row_number() - 1) %/% team_rows + 1,
    y = (row_number() - 1) %% team_rows + 1
  ) |> 
  ungroup()
```
```{r waffle-load-data-exercise, exercise = TRUE}
softball <- data.frame(
  category = c("1B", "2B", "3B", "HR"),
  count = c(325, 101, 10, 107)
)
```
```{r waffle-load-data-exercise-solution}
softball <- data.frame(
  category = c("1B", "2B", "3B", "HR"),
  count = c(325, 101, 10, 107)
)
```
```{r waffle-load-data-exercise-check}
grade_this_code()
```

Now we have to get a little tricky. Instead of a dataframe with four rows in it, we need to create a grid. That grid will have 325 singles, 101 doubles, 10 triples and 107 home runs. How do we do that? It's a little funky the first time you see it. 

### Exercise 1: Make a grid for our waffle chart 

Now we're going to create a dataframe called `waffle_softball`. What is going into it and how it gets made is like this, in this order: 

* First, we set the number of rows. Because we have a lot of squares, we're going to set the number of rows at 10. 
* Then, start our data analysis. `waffle_softball` is going to pull our data from `softball`.
* Next we are going to use the uncount function, which is the opposite of the count function. If `softball` had a team with 10 singles, then uncount turns that into 10 rows of 1B. 
* Next we have to create rows for our waffle chart. We're creating squares that will go left and right on the x-axis and up and down on the y-axis in a grid. 
* `row_number()` is just what you think it is -- what row number is it? Remember uncount made every hit into a row. 
* For the x axis in mutate, `%/%` means divide and drop the remainder. In practice, what that says is if there's 30 doubles, the first 10 will be in row 1, the next 10 will be in row 2 and so forth as specified by the number of rows set above.
* For the y axis, `%%` means do the division and keep the remainder. In practice, that's going to increment the column up one each time. Row 1 column 1. Row 1 column 2. Row 1 column 3 and so on. 
* The + 1 parts just increments everything so the counts start at 1 not 0. 

```{r waffle, exercise=TRUE, exercise.setup = "waffle-load-data", message=FALSE}
rows <- ____ 

waffle_softball <- ____ |>
  uncount(count) |>
  mutate(
    x = (row_number() - 1) %/% rows + 1,
    y = (row_number() - 1) %% rows + 1
  )
```
```{r waffle-solution, exercise.reveal_solution = FALSE}
rows <- 10

waffle_softball <- softball |>
  uncount(count) |>
  mutate(
    x = (row_number() - 1) %/% rows + 1,
    y = (row_number() - 1) %% rows + 1
  )
```
```{r waffle-check}
grade_this_code()
```

Now we've got a grid. Let's make a waffle. 

### Exercise 2: The waffle chart

The geom here is called `geom_tile` and it is like it sounds -- it creates tiles, like a floor. It works similar to what we've done before with stacked bar charts, except instead of a `weight` it takes a `y`. What goes in x and y is very, very simple -- we just created and x and y in mutate above. What goes in x and y is literally x and y. The fill? That's our category (aka 1B, 2B, 3B, HR). 

What comes after is what makes this into a waffle chart. The `color` in this case creates a white line around the tiles and the `linewidth` does what you think it does. `coord_equal` makes all the squares an equal size. Then `theme_void` removes all of the x and y tick marks and labeling so all you see are squares.  

```{r waffle2, exercise=TRUE, exercise.setup = "waffle-load-data", message=FALSE}
ggplot() +
  geom_tile(
    data=____, 
    aes(
      x = x, y = y, fill = ____
      ), 
    color = "white", 
    linewidth = .5) +
  coord_equal() + 
  theme_void()
```
```{r waffle2-solution, exercise.reveal_solution = FALSE}
ggplot() +
  geom_tile(
    data=waffle_softball, 
    aes(
      x = x, y = y, fill = category
      ), 
    color = "white", 
    linewidth = .5) +
  coord_equal() + 
  theme_void()
```
```{r waffle2-check}
grade_this_code()
```

There's a reason they call the triple the most exciting play in baseball (or softball in this case). They're very, very rare. And these Huskers loved the long ball. 

## Make more waffles 

What does it look like if we compare multiple teams? One truth you're going to hear repeated -- one bar isn't a bar chart. One line isn't a line chart. One waffle *can* be a waffle chart if it's detailed and very clear, but our example so far isn't great. It needs more. So how about we compare teams in the Big Ten? 

### Exercise 3: Making a grid from a dataframe

To make lots of waffles, you're going to need lots of things -- teams, players, etc. We *could* do it the way we did it before one team at a time, but who wants to hand enter 17 Big Ten softball team stats? Not me. 

For this, we can use a data from the NCAA. For this, we're going to read in a file of softball team stats. Then, we're going to set a different number of rows. Since we already have something called `rows`, we'll call this one `team_rows` and change our math in mutate to reflect that change. Then, we'll make a dataframe called `team_waffle` that will do a couple of things: First, filter for the Big Ten, then select only the rows we need. Because this has to be long data, we're going to use pivot_longer from the Transforming Data chapter to make it long. After that, it'll look just like above with one small exception -- we need to group this by the team so each team ends up in their own rows and columns. 

```{r waffle3, exercise=TRUE, exercise.setup = "waffle-load-data", message=FALSE}
softball_teams <- read_csv("https://mattwaite.github.io/sportsdatafiles/ncaa_womens_softball_teams_2025.csv")

____ <- 5

team_waffle <- softball_teams |> 
  filter(conference == "Big Ten") |> 
  select(team, w, l, t) |> 
  pivot_longer(cols=-team, names_to = "category", values_to ="count") |> 
  uncount(count) |>
  group_by(____) |> 
  mutate(
    x = (row_number() - 1) %/% ____ + 1,
    y = (row_number() - 1) %% ____ + 1
  ) |> 
  ungroup()
```
```{r waffle3-solution, exercise.reveal_solution = FALSE}
softball_teams <- read_csv("https://mattwaite.github.io/sportsdatafiles/ncaa_womens_softball_teams_2025.csv")

team_rows <- 5

team_waffle <- softball_teams |> 
  filter(conference == "Big Ten") |> 
  select(team, w, l, t) |> 
  pivot_longer(cols=-team, names_to = "category", values_to ="count") |> 
  uncount(count) |>
  group_by(team) |> 
  mutate(
    x = (row_number() - 1) %/% team_rows + 1,
    y = (row_number() - 1) %% team_rows + 1
  ) |> 
  ungroup()
```
```{r waffle3-check}
grade_this_code()
```

Now that we have data to work with, let's make a bunch of waffles all at once. How? 

### Exercise 4: Lots of waffles, one line of code

To make a lot of waffles -- one for each team -- we just need to add something called a facet. We've got a whole chapter ahead on facets, so all you need for now is to know that a facet is one chart for each thing you specify. We're going to specify the `team` as the thing we want a chart out of. Next, we just want to make six columns of facets -- there's 17 softball teams in the Big Ten, so six columns will make 3 rows of charts. 

Everything else in this waffle chart is the same as before, except for the name of the data and the `facet_wrap`, which we'll go into much more depth about in Exercise 25. 

```{r waffle4, exercise=TRUE, exercise.setup = "waffle-load-data", message=FALSE}
ggplot() +
  geom_tile(
    data=team_waffle, 
    aes(
      x = x, y = y, fill = category
      ), 
    color = "white", 
    linewidth = .5) +
  facet_wrap(~____, ncol = ____) +
  coord_equal() + 
  theme_void()
```
```{r waffle4-solution, exercise.reveal_solution = FALSE}
ggplot() +
  geom_tile(
    data=team_waffle, 
    aes(
      x = x, y = y, fill = category
      ), 
    color = "white", 
    linewidth = .5) +
  facet_wrap(~team, ncol = 6) +
  coord_equal() + 
  theme_void()
```
```{r waffle4-check}
grade_this_code()
```

There's more to be done here -- we need some labels to explain things and those colors are awful, as described in the previous chapter, so we could change those the same way. But for now, we've arrived where we need to be -- with lots of waffles all at once. 

## The Recap

In this lesson, we've explored waffle charts as an effective alternative to pie charts for visualizing proportional data in sports analytics. Unlike pie charts, which require viewers to judge angles and areas, waffle charts use a grid of squares that makes comparisons intuitive and accurate. We learned that the waffle library is now abandoned, so we built our charts using just the `tidyverse` and `ggplot2.` The key to creating waffle charts is transforming your data into a grid using `uncount()` to expand categories into individual rows, then calculating x and y positions using integer division (%/%) and modulo (%%) operators. We applied `geom_tile()` to render the grid as colored squares, used `coord_equal()` to ensure uniform square sizes, and `theme_void()` to strip away unnecessary axis elements. Finally, we scaled up to compare multiple teams at once by grouping our data and using `facet_wrap()` to generate a waffle chart for each team in a single visualization. Waffle charts excel at showing parts of a whole, making them ideal for displaying compositions like hit types, win-loss records, or any categorical breakdown in sports data.

## Terms to Know

- Waffle Chart: A visualization that represents proportional data as colored squares in a grid, where each square represents a unit or portion of the whole, making it easier to compare parts than a pie chart.
- `uncount()` Function: A tidyverse function that does the opposite of count()—it expands a summarized dataframe by repeating rows based on a count column, turning aggregated data into individual observations.
- `geom_tile()`: A ggplot2 geom that draws rectangular tiles, used here to create the individual squares of a waffle chart by mapping x and y grid positions.
- Integer Division (%/%): An operator that divides two numbers and returns only the whole number portion, dropping any remainder. Used to determine which row a square belongs to in the waffle grid.
- Modulo (%%): An operator that returns the remainder after division. Used to determine which column a square belongs to within its row.
- `coord_equal()`: A ggplot2 function that forces the x and y axes to have the same scale, ensuring that tiles appear as perfect squares rather than rectangles.
- `theme_void()`: A ggplot2 theme that removes all axis labels, tick marks, and gridlines, leaving only the plotted elements—ideal for waffle charts where axes are meaningless.
- `facet_wrap()`: A ggplot2 function that creates multiple small charts (small multiples), one for each level of a specified variable, allowing easy comparison across groups like teams.